<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratory Assistant</title>
     <link rel="icon" href="favicon2.png" type="image/x-icon">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #1d4ed8; /* blue-700 */
            --primary-darker: #1e40af; /* blue-800 */
            --secondary-color: #2dd4bf; /* teal-400 */
            --accent-color: #f43f5e; /* rose-500 */
            --text-primary: #111827; /* gray-900 */
            --text-secondary: #6b7280; /* gray-500 */
            --bg-light: #f8fafc; /* slate-50 */
            --border-color: #e2e8f0; /* slate-200 */
            --bg-dark: #1f2937; /* gray-800 */
            --sidebar-bg-1: #374151; /* gray-700 */
            --sidebar-bg-2: #111827; /* gray-900 */
            --sidebar-text: #f3f4f6; /* gray-100 */
        }
        html {
            scroll-behavior: smooth;
            height: -webkit-fill-available;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(
  to bottom,
  #616161 0%,        /* Top 10% */
  #616161 5%,
  #ffffff 10%,       /* Middle 80% */
  #ffffff 90%,
  #ffffff 95%,       /* Bottom 10% */
  #ffffff 100%
);

            
            color: var(--text-primary);
            font-size: 1rem;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            transition: all 1s ease-in-out;
        }

        /* Custom Scrollbar Styling (Webkit Browsers) */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
            display: NONE !important;
        }

        ::-webkit-scrollbar-track {
            background-color: var(--border);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background-color: #adb5bd;
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: padding-box;
        }

        ::-webkit-scrollbar-thumb:active {
            background-color: #6c757d;
        }

        *, ::after, ::before {
            box-sizing: border-box;
            border-style: none !important;
        }


        #main-content{
            padding: 0px;
        }

        /* Sidebar */
        .sidebar {
            transition: transform 0.3s ease-in-out, width 0.3s ease-in-out;
            background: radial-gradient(circle, #3b4a5ddd 0%, #616161 100%);
            width: 240px;
            color: #bbbbbbea;
            overflow: hidden !important;
            z-index: 1000;
        }

        
/* Sidebar container */
#sidebar {

    height: 100vh;
    overflow-x: hidden; /* Prevent horizontal scrolling */
    overflow-y: auto; /* Enable vertical scrolling */
    scrollbar-width: none; /* Firefox: Hide scrollbar */
    -ms-overflow-style: none; /* IE/Edge: Hide scrollbar */
}

/* Webkit browsers (Chrome, Safari, Edge): Hide scrollbar */
#sidebar::-webkit-scrollbar {
    display: none ;
}

/* Sidebar navigation content */
#sidebar-nav {
    width: 100%; /* Ensure content fits within sidebar width */
    overflow-x: hidden; /* Extra precaution to prevent horizontal scroll */
}






        .sidebar-header {
            position: sticky;
            top: 0;
            font-size: 1rem;
            font-weight: 600;
            word-spacing: 3px;
            letter-spacing: 2px;
            text-align: right;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            color: #aadee8;
          
        }

        .sidebar-item {
            font-size: 0.8rem;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            margin: 0.25rem 0.5rem;
            border-radius: 30px;
            position: relative;
            background-color: #333232;
            box-shadow:
                inset 0 2px 5px rgba(41, 41, 41, 0.473),
                inset 0 0 5px rgba(37, 37, 37, 0.581);
        }

        .sidebar-item:hover {
            background-color: #333232;
            color: rgb(249, 250, 229);
            box-shadow:
                inset 0 2px 5px rgba(41, 41, 41, 0.473),
                inset 0 0 5px rgba(37, 37, 37, 0.581);
            transform: translateX(4px);
            scale: 1.06;
            z-index: 10;
        }


        .sidebar-main-item {
            padding: 0.55rem 1rem;
            width: 200px;
        }

        .sidebar-main-item.active {
            background-color: #2d2d2d;
            color: #faf3ce;
            font-weight: 600;
            box-shadow:
                inset 0 2px 5px rgba(41, 41, 41, 0.473),
                inset 0 0 5px rgba(37, 37, 37, 0.581);
                transform: translateX(4px);
        }

        .sidebar-item.active::after{
            content: '';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 10px;
            height: 10px;
            background-color: #ffffffcd;
            border-radius: 50%;
            box-shadow:
                inset 0 2px 3px rgba(27, 27, 27, 0.518),
                inset 0 0 3px rgba(43, 43, 43, 0.5);
                transition: all 0.3s ease;
        }


        .sidebar-submenu-item {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: flex-start;
          
            padding: 0.5rem 2rem;
            font-size: 0.74rem;
            font-weight: 400;
            margin: 0.5rem 1rem;
            border-radius: 15px;
            border-radius: 30px;
            position: relative;
            transition: all 0.3s ease;
        }

        
        .sidebar-submenu-item.active {
            position: relative;
            background-color: var(--bg-light);
            color: #1c8b00;
            font-size: 0.9rem;
            font-weight: 500;
            border-left-color: #1d4ed8;
            border-radius: 80px;
            box-shadow:
                0 4px 8px rgba(255, 255, 255, 0.4),
                0 2px 6px rgba(0, 0, 0, 0.08);
        }


        .sidebar-submenu-item:hover {
            color: #ffffff;
            transform: translateX(2px);
        } 


        .sidebar-submenu-item.active:hover {
            background-color: #ffffff !important;
            color: #00ad0c;
            font-weight: 600;
        }


        @media (max-width: 1460px) {
            .sidebar-submenu-item.active::after,
            .sidebar-submenu-item.active::before {
                display: none;
            }
        }


         /* The Magic: Curve Outside Effect */
         .sidebar-submenu-item.active::before,
         .sidebar-submenu-item.active::after {
            content: "";
            position: absolute;
            right: 59px;
            width: 40px;
            height: 51px;
            background-color: #2a2a2a00;
            z-index: -1;

            transition: all 1s ease, color 1s ease;
        }
        
        .sidebar-submenu-item.active::before {
            top: -50px;
            border-bottom-right-radius: 30px;
            box-shadow: 15px 20px 0 var(--bg-light);
        }
        
        .sidebar-submenu-item.active::after {
            bottom: -50px;
            border-top-right-radius: 30px;
            box-shadow: 15px -20px 0 var(--bg-light);
        }







        .sidebar-submenu-item.active i {
            margin-right: 5px;
            color: #d8231d;
            transform: scale(1.1);
        }

     .submenu-container {
    height: 0;
    width: 20vw;
    overflow: hidden;
    margin: 0.5rem 0.5rem;
    border-radius: 50px;
    align-items: right;
    text-align: right;
    display: flex;
    justify-content: right;
    flex-direction: column;
    align-content: right;
    background-color: #2a2a2a;
    box-shadow:
        0 2px 5px rgba(171, 171, 171, 0.345),
        inset 0 0 5px rgba(223, 223, 223, 0.262);
    padding-left: 60px !important;
    transform: scaleY(0);
    transform-origin: top;
    transition: transform 0.3s ease-in-out,
                height 0.3s ease-in-out,
                padding 0.3s ease-in-out;
    will-change: transform, height, padding;
    z-index: 1000;
    visibility: hidden; /* Ensure hidden when closed */
}

.submenu-container.active {
    height: auto;
    transform: scaleY(1);
    padding: 1.5rem 0;
    visibility: visible; /* Ensure visible when open */
    transition: transform 0.3s ease-out,
                height 0.3s ease-out,
                padding 0.3s ease-out;
}

        .sidebar-item i {
            transition: transform 0.2s ease, color 0.2s ease;
        }

        .sidebar-submenu-item i {
            margin-right: 5px;
            font-size: 0.9rem;
        }

        .sidebar-item:hover i {
            transform: scale(1.15);
        }

        #breadcrumb {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .submenu-container {
                width: auto;
            }
        }

        /* Header */
        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 40;
        }

        #user-dropdown {
            transform: translateY(-10px);
            opacity: 0;
            transition: transform 0.2s ease, opacity 0.2s ease;
        }

        #user-dropdown:not(.hidden) {
            transform: translateY(0);
            opacity: 1;
        }

        img[alt="User Avatar"] {
            border: 2px solid var(--primary-color);
        }

        /* Main Content & Page Transitions */
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            padding: 0;
            margin-top: 0;
            border-radius: 0;
        }

        #main-content {
            margin-top: 0;
            border-radius: 0;
        }

        input[type="text"] {
            border: 2px solid rgb(161, 222, 255) !important;
        }

        @media (min-width: 768px) {
            main.sidebar-collapsed {
                margin-left: 0;
            }
        }

        @media (max-width: 767px) {
            main {
                padding-bottom: 60px;
            }
        }

        .page-content {
            flex: 1;
            display: none;
            opacity: 0;
            transform: translateY(15px);
            transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
            width: 100%;
            height: 100%;
            position: relative;
        }

        .page-content.active {
            display: flex;
            flex-direction: column;
            opacity: 1;
            transform: translateY(0);
        }

        /* Bottom Navigation */
        .bottom-nav {
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);
            z-index: 50;
            height: 60px;
        }

        .bottom-nav-item {
            transition: color 0.2s ease, background-color 0.2s ease;
        }

        .bottom-nav-item.active {
            color: var(--primary-color);
            background: #eff6ff;
        }

        .bottom-nav-item.active i {
            transform: scale(1.2);
        }

        .bottom-nav-item.active i, .bottom-nav-item.active span {
            font-weight: 500;
        }

        .bottom-nav-item:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* Stat Cards */
        .stat-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border: 1px solid var(--border-color);
            animation: fadeInUp 0.5s ease-out forwards;
            animation-delay: calc(var(--order) * 0.1s);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.07);
            border-color: var(--primary-color);
        }

        .stat-card .icon-bg {
            flex-shrink: 0;
            background-color: var(--secondary-color);
            color: white;
        }

        /* Buttons */
        .btn {
            transition: all 0.2s ease;
            font-weight: 500;
            border-radius: 0.375rem;
            padding: 0.625rem 1.25rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-darker));
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-darker);
            box-shadow: 0 6px 12px rgba(29, 78, 216, 0.3);
        }

        .nav {
            overflow: hidden !important;
        }

        /* Overlay */
        .overlay {
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
            visibility: hidden;
            z-index: 45;
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

    iframe {
    border-radius: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    flex: 1;
    box-shadow: -10px 0 15px -5px rgba(255, 255, 255, 0.5);
    z-index: 1000;
    opacity: 1;
    transition: opacity 0.3s ease;
}

    iframe[loading] {
    opacity: 0;
    }

.loading-container {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.loading-container:not(.hidden) {
    opacity: 1;
}
    </style>
</head>
<body class="text-base">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar fixed inset-y-0 left-0 bg-white border-r transform -translate-x-full md:translate-x-0 md:sticky md:top-0 md:flex flex-col h-screen">
            <div class="sidebar-header">
                <div class="flex items-center">
                    <i class="fas fa-flask text-blue-500 text-2xl mr-2"></i>
                    <span>Lab Assistant</span>
                </div>
            </div>
            <nav class="flex-1 py-1 space-y-1 overflow-y-auto" id="sidebar-nav"> <!-- Added overflow-y-auto for long menus -->
                <a href="#" class="sidebar-item sidebar-main-item flex items-center px-2 py-1 " data-page="dashboard" data-tooltip="Dashboard">
                    <i class="fas fa-tachometer-alt fa-fw w-6 mr-3 "></i>
                    <span>Dashboard</span>
                </a>
                <div class="submenu-container" id="dashboard-submenu">
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5  " data-subpage="overview" data-tooltip="Overview">
                        <i class="fas fa-chart-pie fa-fw text-gray-400"></i>
                        <span>Overview</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5  " data-subpage="analytics" data-tooltip="Analytics">
                        <i class="fas fa-chart-bar fa-fw text-gray-400"></i>
                        <span>Analytics</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5  " data-subpage="schedule" data-tooltip="Schedule">
                        <i class="fas fa-calendar-alt fa-fw text-gray-400"></i>
                        <span>Schedule</span>
                    </a>
                </div>

                <a href="#" class="sidebar-item sidebar-main-item flex items-center px-2 py-1 " data-page="calculations" data-tooltip="Calculations">
                    <i class="fas fa-calculator fa-fw w-6 mr-3 "></i> <!-- Changed icon for main Calculations -->
                    <span>Calculations</span>
                </a>
                <div class="submenu-container" id="calculations-submenu">
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="calculations-egfr" data-tooltip="eGFR Calculation">
                        <i class="fas fa-calculator fa-fw text-gray-400"></i> <!-- Kept specific icon -->
                        <span>eGFR</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="calculations-dilution" data-tooltip="Dilution Calculator">
                        <i class="fas fa-vials fa-fw text-gray-400"></i> <!-- Icon for dilution -->
                        <span>Dilution</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="calculations-elisa" data-tooltip="ELISA Calculation">
                        <i class="fas fa-wave-square fa-fw text-gray-400"></i> <!-- Icon for ELISA -->
                        <span>ELISA</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="calculations-acr" data-tooltip="ACR Calculation">
                        <i class="fas fa-prescription-bottle fa-fw text-gray-400"></i> <!-- Icon for ACR -->
                        <span>ACR</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="calculations-ccr" data-tooltip="CCR Calculation">
                        <i class="fas fa-percentage fa-fw text-gray-400"></i>
                        <span>CCR</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="calculations-electrolyte" data-tooltip="Electrolyte Balance">
                        <i class="fas fa-bolt fa-fw text-gray-400"></i>
                        <span>Electrolytes</span>
                    </a>
                </div>

                <a href="#" class="sidebar-item sidebar-main-item flex items-center px-2 py-1 " data-page="qualitycontrol" data-tooltip="Quality Control">
                    <i class="fas fa-clipboard-check fa-fw w-6 mr-3 "></i>
                    <span>Quality Control</span>
                </a>
                <div class="submenu-container" id="qualitycontrol-submenu">
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="qc-biochemistry" data-tooltip="Biochemistry QC">
                        <i class="fas fa-atom fa-fw text-gray-400"></i>
                        <span>Biochemistry</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="qc-immunology" data-tooltip="Immunology QC">
                        <i class="fas fa-shield-virus fa-fw text-gray-400"></i>
                        <span>Immunology</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="qc-hematology" data-tooltip="Hematology QC">
                        <i class="fas fa-tint fa-fw text-gray-400"></i> <!-- fa-tint for blood drops -->
                        <span>Hematology</span>
                    </a>
                </div>

                <a href="#" class="sidebar-item sidebar-main-item flex items-center px-2 py-1 " data-page="inventory" data-tooltip="Inventory">
                    <i class="fas fa-boxes fa-fw w-6 mr-3 "></i>
                    <span>Inventory</span>
                </a>
                <div class="submenu-container" id="inventory-submenu">
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5  " data-subpage="inventory-all" data-tooltip="All Items">
                        <i class="fas fa-th-list fa-fw text-gray-400"></i>
                        <span>All Items</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5  " data-subpage="inventory-manage" data-tooltip="Manage Items & Stock">
                        <i class="fas fa-tasks fa-fw text-gray-400"></i>
                        <span>Manage Items</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5  " data-subpage="inventory-consumption" data-tooltip="Consumption Tracking">
                        <i class="fas fa-chart-line fa-fw text-gray-400"></i>
                        <span>Consumption</span>
                    </a>
                     <a href="#" class="sidebar-submenu-item flex items-center py-0.5  " data-subpage="inventory-orders" data-tooltip="Manage Orders">
                        <i class="fas fa-shipping-fast fa-fw text-gray-400"></i>
                        <span>Orders</span>
                    </a>
                </div>

                <a href="#" class="sidebar-item sidebar-main-item flex items-center px-2 py-1 " data-page="roster" data-tooltip="Laboratory Roster">
                    <i class="fas fa-calendar-check fa-fw w-6 mr-3 "></i>
                    <span>Lab Roster</span>
                </a>
                <div class="submenu-container" id="roster-submenu">
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="roster-all" data-tooltip="View All Rosters">
                        <i class="fas fa-list-ul fa-fw text-gray-400"></i>
                        <span>All Rosters</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="roster-daily" data-tooltip="Daily Roster">
                        <i class="fas fa-calendar-day fa-fw text-gray-400"></i>
                        <span>Daily Roster</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="roster-manage" data-tooltip="Manage Roster">
                        <i class="fas fa-user-edit fa-fw text-gray-400"></i>
                        <span>Manage Roster</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="roster-leave" data-tooltip="Leave Count">
                        <i class="fas fa-user-minus fa-fw text-gray-400"></i>
                        <span>Leave Count</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="roster-allowance" data-tooltip="Allowance Count">
                        <i class="fas fa-file-invoice-dollar fa-fw text-gray-400"></i>
                        <span>Allowance Count</span>
                    </a>
                </div>

<a href="#" class="sidebar-item sidebar-main-item flex items-center px-2 py-1 " data-page="semenanalysis" data-tooltip="Semen Analysis Module">
    <i class="fas fa-vial fa-fw w-6 mr-3 "></i>
    <span>Semen Analysis</span>
</a>
<div class="submenu-container" id="semenanalysis-submenu">
    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="semen-input" data-tooltip="Data Input">
        <i class="fas fa-edit fa-fw text-gray-400"></i>
        <span>Data Input</span>
    </a>
    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="semen-results" data-tooltip="View Results">
        <i class="fas fa-poll fa-fw text-gray-400"></i>
        <span>View Results</span>
    </a>
    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="semen-print" data-tooltip="Print Reports">
        <i class="fas fa-file-download fa-fw text-gray-400"></i>
        <span>Print Reports</span>
    </a>
</div>

                <a href="#" class="sidebar-item sidebar-main-item flex items-center px-2 py-1 " data-page="reportanalysis" data-tooltip="Report Analysis">
                    <i class="fas fa-magnifying-glass-chart fa-fw w-6 mr-3 "></i>
                    <span>Report Analysis</span>
                </a>
                <div class="submenu-container" id="reportanalysis-submenu">
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="analysis-general" data-tooltip="General Tests Analysis">
                        <i class="fas fa-file-medical fa-fw text-gray-400"></i>
                        <span>General Tests</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="analysis-semen" data-tooltip="Semen Analysis Trends">
                        <i class="fas fa-microscope fa-fw text-gray-400"></i>
                        <span>Semen Analysis</span>
                    </a>
                     <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="analysis-trends" data-tooltip="Trend Analysis">
                        <i class="fas fa-chart-line fa-fw text-gray-400"></i>
                        <span>Trend Analysis</span>
                    </a>
                </div>

                <a href="#" class="sidebar-item sidebar-main-item flex items-center px-2 py-1 " data-page="reportgeneration" data-tooltip="Report Generation">
                    <i class="fas fa-print fa-fw w-6 mr-3 "></i>
                    <span>Report Generation</span>
                </a>
                <div class="submenu-container" id="reportgeneration-submenu">
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="gen-biochemical" data-tooltip="Biochemical Reports">
                        <i class="fas fa-flask fa-fw text-gray-400"></i>
                        <span>Biochemical</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="gen-immunology" data-tooltip="Immunology Reports">
                        <i class="fas fa-dna fa-fw text-gray-400"></i>
                        <span>Immunology</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="gen-serology" data-tooltip="Serology Reports">
                        <i class="fas fa-tint fa-fw text-gray-400"></i>
                        <span>Serology</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="gen-microbiology" data-tooltip="Microbiology Reports">
                        <i class="fas fa-bacteria fa-fw text-gray-400"></i>
                        <span>Microbiology</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="gen-urine" data-tooltip="Urine Analysis Reports">
                        <i class="fas fa-prescription-bottle fa-fw text-gray-400"></i>
                        <span>Urine</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="gen-stool" data-tooltip="Stool Analysis Reports">
                        <i class="fas fa-poo fa-fw text-gray-400"></i>
                        <span>Stool</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="gen-afb" data-tooltip="AFB Smear Reports">
                        <i class="fas fa-lungs fa-fw text-gray-400"></i>
                        <span>AFB</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="gen-gramstain" data-tooltip="Gram Stain Reports">
                        <i class="fas fa-eye-dropper fa-fw text-gray-400"></i>
                        <span>Gram Stain</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="gen-fluidcytology" data-tooltip="Fluid Cytology Reports">
                        <i class="fas fa-disease fa-fw text-gray-400"></i>
                        <span>Fluid Cytology</span>
                    </a>
                     <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="gen-custom" data-tooltip="Custom Report Templates">
                        <i class="fas fa-file-pen fa-fw text-gray-400"></i>
                        <span>Custom Templates</span>
                    </a>
                </div>

                <a href="#" class="sidebar-item sidebar-main-item flex items-center px-2 py-1 " data-page="documentation" data-tooltip="Documentation & SOPs">
                    <i class="fas fa-folder-open fa-fw w-6 mr-3 "></i>
                    <span>Documentation</span>
                </a>
                <div class="submenu-container" id="documentation-submenu">
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="doc-qcsummary" data-tooltip="QC Summary Documents">
                        <i class="fas fa-file-contract fa-fw text-gray-400"></i>
                        <span>QC Summary</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="doc-consumption" data-tooltip="Consumption Reports/Docs">
                        <i class="fas fa-file-lines fa-fw text-gray-400"></i>
                        <span>Consumption Docs</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="doc-sops" data-tooltip="Standard Operating Procedures">
                        <i class="fas fa-book-open fa-fw text-gray-400"></i>
                        <span>SOPs</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5" data-subpage="doc-training" data-tooltip="Training Materials">
                        <i class="fas fa-chalkboard-teacher fa-fw text-gray-400"></i>
                        <span>Training Materials</span>
                    </a>
                </div>
                
                <a href="#" class="sidebar-item sidebar-main-item flex items-center px-2 py-1 " data-page="generalreports" data-tooltip="General Reports">
                    <i class="fas fa-chart-area fa-fw w-6 mr-3 "></i>
                    <span>General Reports</span>
                </a>
                <div class="submenu-container" id="generalreports-submenu">
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5  " data-subpage="report-overview" data-tooltip="Reports Overview">
                        <i class="fas fa-file-alt fa-fw text-gray-400"></i>
                        <span>Overview</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5  " data-subpage="report-custom" data-tooltip="Create Custom Reports">
                        <i class="fas fa-cogs fa-fw text-gray-400"></i>
                        <span>Custom Reports</span>
                    </a>
                </div>

                <a href="#" class="sidebar-item sidebar-main-item flex items-center px-2 py-1 " data-page="tools" data-tooltip="Utility Tools">
                    <i class="fas fa-tools fa-fw w-6 mr-3 "></i>
                    <span>Tools</span>
                </a>
                <div class="submenu-container" id="tools-submenu">
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5  " data-subpage="tools-calendar" data-tooltip="Calendar">
                        <i class="fas fa-calendar-days fa-fw text-gray-400"></i>
                        <span>Calendar</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5  " data-subpage="tools-calculator" data-tooltip="Calculator">
                        <i class="fas fa-calculator fa-fw text-gray-400"></i>
                        <span>Calculator</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5  " data-subpage="tools-clock" data-tooltip="Clock">
                        <i class="fas fa-clock fa-fw text-gray-400"></i>
                        <span>Clock</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5  " data-subpage="tools-timer" data-tooltip="Timer & Stopwatch">
                        <i class="fas fa-stopwatch-20 fa-fw text-gray-400"></i>
                        <span>Timer</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5  " data-subpage="tools-notepad" data-tooltip="Notepad">
                        <i class="fas fa-note-sticky fa-fw text-gray-400"></i>
                        <span>Notepad</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5  " data-subpage="tools-unitconverter" data-tooltip="Unit Converter">
                        <i class="fas fa-right-left fa-fw text-gray-400"></i>
                        <span>Unit Converter</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5  " data-subpage="tools-referenceranges" data-tooltip="Reference Ranges">
                        <i class="fas fa-book-medical fa-fw text-gray-400"></i>
                        <span>Reference Ranges</span>
                    </a>
                </div>

                <a href="#" class="sidebar-item sidebar-main-item flex items-center px-2 py-1 " data-page="settings" data-tooltip="Settings">
                    <i class="fas fa-cog fa-fw w-6 mr-3 "></i>
                    <span>Settings</span>
                </a>
                <div class="submenu-container" id="settings-submenu">
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5  " data-subpage="settings-account" data-tooltip="Account Settings">
                        <i class="fas fa-user-cog fa-fw text-gray-400"></i>
                        <span>Account</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5  " data-subpage="settings-team" data-tooltip="Team Management">
                        <i class="fas fa-users-cog fa-fw text-gray-400"></i>
                        <span>Team</span>
                    </a>
                    <a href="#" class="sidebar-submenu-item flex items-center py-0.5  " data-subpage="settings-notifications" data-tooltip="Notification Preferences">
                        <i class="fas fa-bell fa-fw text-gray-400"></i>
                        <span>Notifications</span>
                    </a>
                     <a href="#" class="sidebar-submenu-item flex items-center py-0.5  " data-subpage="settings-lab" data-tooltip="Lab Configuration">
                        <i class="fas fa-microscope fa-fw text-gray-400"></i>
                        <span>Lab Setup</span>
                    </a>
                </div>
            </nav>
            <div class="p-2 border-t border-gray-200 mt-auto">
                <a href="#" class="flex items-center hover:text-blue-500">
                    <i class="fas fa-question-circle fa-fw mr-2"></i>
                    Help & Support
                </a>
            </div>
        </aside>

        <!-- Overlay for mobile sidebar -->
        <div id="overlay" class="overlay fixed inset-0 bg-black bg-opacity-50 md:hidden"></div>

        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col overflow-hidden main-content-area"> <!-- Added main-content-area class for potential specific styling -->
            <!-- Header -->
            <header class="bg-white h-16 flex items-center justify-between px-4 sm:px-6 flex-shrink-0">
                <div class="flex items-center flex-1">
                    <button id="menu-toggle-btn" class="md:hidden mr-3 hover:text-gray-900">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <div class="relative hidden md:block mr-4">
                        <input type="text" placeholder="Search..." class="pl-10 pr-4 py-0.5 rounded-full border">
                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    </div>
                    <nav class="flex items-center " aria-label="Breadcrumb">
                        <ol class="inline-flex items-center space-x-1 md:space-x-2" id="breadcrumb">
                            <li class="inline-flex items-center">
                                <a href="#" class="hover:text-blue-500 inline-flex items-center" data-page="dashboard">
                                    <i class="fas fa-home mr-1.5"></i>
                                    Home
                                </a>
                            </li>
                            <li>
                                <div class="flex items-center">
                                    <i class="fas fa-chevron-right text-gray-400 mx-1.5 text-xs"></i>
                                    <span class="font-medium" id="breadcrumb-current">Dashboard</span>
                                </div>
                            </li>
                            <li id="breadcrumb-subpage-container" class="hidden">
                                <div class="flex items-center">
                                    <i class="fas fa-chevron-right text-gray-400 mx-1.5 text-xs"></i>
                                    <span class="" id="breadcrumb-subpage">Sub Page</span>
                                </div>
                            </li>
                        </ol>
                    </nav>
                </div>
                <div class="flex items-center space-x-4">
                    <button class="hover: relative" aria-label="Notifications">
                        <i class="fas fa-bell"></i>
                        <span class="absolute -top-1 -right-1 flex h-2 w-2">
                            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-2 w-2 bg-red-500"></span>
                        </span>
                    </button>
                    <div class="relative">
                        <button class="flex items-center space-x-2 focus:outline-none" id="user-menu-btn" aria-haspopup="true" aria-expanded="false">
                            <img class="h-8 w-8 rounded-full object-cover" src="https://ui-avatars.com/api/?name=User+Name&background=e0f2fe&color=0284c7" alt="User Avatar">
                            <span class="hidden md:inline-block font-medium">User Name</span>
                            <i class="fas fa-chevron-down text-xs"></i>
                        </button>
                        <div id="user-dropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 hidden ring-1 ring-black ring-opacity-5" role="menu">
                            <a href="#" class="block px-4 py-2 hover:bg-gray-100" role="menuitem">
                                <i class="fas fa-user-circle fa-fw mr-2"></i>Profile
                            </a>
                            <a href="#" class="block px-4 py-2 hover:bg-gray-100" role="menuitem">
                                <i class="fas fa-cog fa-fw mr-2"></i>Settings
                            </a>
                            <div class="border-t border-gray-100 my-1"></div>
                            <a href="#" class="block px-4 py-2 hover:bg-gray-100" role="menuitem">
                                <i class="fas fa-sign-out-alt fa-fw mr-2"></i>Sign out
                            </a>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="flex-1 overflow-y-auto p-4 sm:p-6" id="main-content">
                <div class="page-content active" id="dashboard-content">
                   <iframe id="dashboard-iframe" data-src="dashboard-overview.html" class="w-full h-full"></iframe>

                </div>
                <div class="page-content" id="calculations-content">
                    <div class="loading-container hidden" id="calculations-loading"><div class="loading-spinner"></div></div>
                    <iframe id="calculations-iframe" data-src="calculations.html" class="w-full h-full"></iframe>
                </div>
                <div class="page-content" id="qualitycontrol-content">
                    <div class="loading-container hidden" id="qualitycontrol-loading"><div class="loading-spinner"></div></div>
                    <iframe id="qualitycontrol-iframe" data-src="qualitycontrol.html" class="w-full h-full"></iframe>
                </div>
                <div class="page-content" id="inventory-content">
                    <div class="loading-container hidden" id="inventory-loading"><div class="loading-spinner"></div></div>
                    <iframe id="inventory-iframe" data-src="inventory.html" class="w-full h-full"></iframe>
                </div>
                <div class="page-content" id="roster-content">
                    <div class="loading-container hidden" id="roster-loading"><div class="loading-spinner"></div></div>
                    <iframe id="roster-iframe" data-src="roster.html" class="w-full h-full"></iframe>
                </div>
                <div class="page-content" id="semenanalysis-content"> <!-- Updated from semen-content -->
                    <div class="loading-container hidden" id="semenanalysis-loading"><div class="loading-spinner"></div></div>
                    <iframe id="semenanalysis-iframe" data-src="semen.html" class="w-full h-full"></iframe>
                </div>
                <div class="page-content" id="reportanalysis-content">
                    <div class="loading-container hidden" id="reportanalysis-loading"><div class="loading-spinner"></div></div>
                    <iframe id="reportanalysis-iframe" data-src="reportanalysis.html" class="w-full h-full"></iframe>
                </div>
                <div class="page-content" id="reportgeneration-content">
                    <div class="loading-container hidden" id="reportgeneration-loading"><div class="loading-spinner"></div></div>
                    <iframe id="reportgeneration-iframe" data-src="reportgeneration.html" class="w-full h-full"></iframe>
                </div>
                <div class="page-content" id="documentation-content">
                    <div class="loading-container hidden" id="documentation-loading"><div class="loading-spinner"></div></div>
                    <iframe id="documentation-iframe" data-src="documentation.html" class="w-full h-full"></iframe>
                </div>
                <div class="page-content" id="generalreports-content"> <!-- Updated from reports-content -->
                    <div class="loading-container hidden" id="generalreports-loading"><div class="loading-spinner"></div></div>
                    <iframe id="generalreports-iframe" data-src="generalreports.html" class="w-full h-full"></iframe>
                </div>
                <div class="page-content" id="tools-content">
                    <div class="loading-container hidden" id="tools-loading"><div class="loading-spinner"></div></div>
                    <iframe id="tools-iframe" data-src="tools.html" class="w-full h-full"></iframe>
                </div>
                <div class="page-content" id="settings-content">
                    <div class="loading-container hidden" id="settings-loading"><div class="loading-spinner"></div></div>
                    <iframe id="settings-iframe" data-src="settings.html" class="w-full h-full"></iframe>
                </div>
            </main>

            <!-- Bottom Navigation (Mobile Only) -->
            <nav class="bottom-nav md:hidden fixed bottom-0 left-0 right-0 bg-white flex items-center justify-around border-t border-gray-200" role="navigation" aria-label="Mobile main navigation">
                <a href="#" class="bottom-nav-item flex-1 flex flex-col items-center justify-center py-2 text-center active" data-page="dashboard" aria-label="Navigate to Dashboard" aria-current="page">
                    <i class="fas fa-tachometer-alt text-xl mb-0.5"></i>
                    <span class="text-xs font-medium">Dashboard</span>
                </a>
                <a href="#" class="bottom-nav-item flex-1 flex flex-col items-center justify-center py-2 text-center" data-page="calculations" aria-label="Navigate to calculations">
                    <i class="fas fa-calculator text-xl mb-0.5"></i> <!-- Matched icon with sidebar -->
                    <span class="text-xs font-medium">Calculations</span>
                </a>
                <a href="#" class="bottom-nav-item flex-1 flex flex-col items-center justify-center py-2 text-center" data-page="inventory" aria-label="Navigate to Inventory">
                    <i class="fas fa-boxes text-xl mb-0.5"></i>
                    <span class="text-xs font-medium">Inventory</span>
                </a>
                <a href="#" class="bottom-nav-item flex-1 flex flex-col items-center justify-center py-2 text-center" data-page="semenanalysis" aria-label="Navigate to Semen Analysis"> <!-- Updated data-page -->
                    <i class="fas fa-vial text-xl mb-0.5"></i>
                    <span class="text-xs font-medium">Semen</span>
                </a>
                <!-- You might want to add one more common item here for mobile, e.g., Tools or Reports -->
                 <a href="#" class="bottom-nav-item flex-1 flex flex-col items-center justify-center py-2 text-center" data-page="tools" aria-label="Navigate to Tools">
                    <i class="fas fa-tools text-xl mb-0.5"></i>
                    <span class="text-xs font-medium">Tools</span>
                </a>
            </nav>
        </div>
    </div>

   <script>
const sidebar = document.getElementById('sidebar');
const sidebarNav = document.getElementById('sidebar-nav');
const menuToggleBtn = document.getElementById('menu-toggle-btn');
const overlay = document.getElementById('overlay');
const userMenuBtn = document.getElementById('user-menu-btn');
const userDropdown = document.getElementById('user-dropdown');
const bottomNav = document.querySelector('.bottom-nav');
const breadcrumbCurrent = document.getElementById('breadcrumb-current');
const breadcrumbSubpageContainer = document.getElementById('breadcrumb-subpage-container');
const breadcrumbSubpage = document.getElementById('breadcrumb-subpage');
const pageContents = document.querySelectorAll('.page-content');
const submenuContainers = document.querySelectorAll('.submenu-container');

const pages = {
    dashboard: {
        title: 'Dashboard',
        subpages: {
            'overview': { title: 'Overview', url: 'dashboard-overview.html' },
            'analytics': { title: 'Analytics', url: 'dashboard-analytics.html' },
            'schedule': { title: 'Schedule', url: 'dashboard-schedule.html' }
        }
    },
    calculations: {
        title: 'Calculations',
        subpages: {
            'calculations-egfr': { title: 'eGFR Calculation', url: 'calculations-egfr.html' },
            'calculations-dilution': { title: 'Dilution Calculator', url: 'calculations-dilution.html' },
            'calculations-elisa': { title: 'ELISA Calculation', url: 'calculations-elisa.html' },
            'calculations-acr': { title: 'ACR Calculation', url: 'calculations-acr.html' },
            'calculations-ccr': { title: 'CCR Calculation', url: 'calculations-ccr.html' },
            'calculations-electrolyte': { title: 'Electrolyte Balance', url: 'calculations-electrolyte.html' }
        }
    },
    qualitycontrol: {
        title: 'Quality Control',
        subpages: {
            'qc-biochemistry': { title: 'Biochemistry QC', url: 'qc-biochemistry.html' },
            'qc-immunology': { title: 'Immunology QC', url: 'qc-immunology.html' },
            'qc-hematology': { title: 'Hematology QC', url: 'qc-hematology.html' }
        }
    },
    inventory: {
        title: 'Inventory',
        subpages: {
            'inventory-all': { title: 'All Items', url: 'inventory-all.html' },
            'inventory-manage': { title: 'Manage Items & Stock', url: 'inventory-manage.html' },
            'inventory-consumption': { title: 'Consumption Tracking', url: 'inventory-consumption.html' },
            'inventory-orders': { title: 'Manage Orders', url: 'inventory-orders.html' }
        }
    },
    roster: {
        title: 'Lab Roster',
        subpages: {
            'roster-all': { title: 'View All Rosters', url: 'roster-all.html' },
            'roster-daily': { title: 'Daily Roster', url: 'roster-daily.html' },
            'roster-manage': { title: 'Manage Roster', url: 'roster-manage.html' },
            'roster-leave': { title: 'Leave Count', url: 'roster-leave.html' },
            'roster-allowance': { title: 'Allowance Count', url: 'roster-allowance.html' }
        }
    },
    semenanalysis: {
        title: 'Semen Analysis',
        subpages: {
            'semen-input': { title: 'Data Input', url: 'semen-input.html' },
            'semen-results': { title: 'View Results', url: 'semen-results.html' },
            'semen-print': { title: 'Print Reports', url: 'semen-print.html' }
        }
    },
    reportanalysis: {
        title: 'Report Analysis',
        subpages: {
            'analysis-general': { title: 'General Tests Analysis', url: 'reportanalysis-general.html' },
            'analysis-semen': { title: 'Semen Analysis Trends', url: 'reportanalysis-semen.html' },
            'analysis-trends': { title: 'Trend Analysis', url: 'reportanalysis-trends.html' }
        }
    },
    reportgeneration: {
        title: 'Report Generation',
        subpages: {
            'gen-biochemical': { title: 'Biochemical Reports', url: 'reportgeneration-biochemical.html' },
            'gen-immunology': { title: 'Immunology Reports', url: 'reportgeneration-immunology.html' },
            'gen-serology': { title: 'Serology Reports', url: 'reportgeneration-serology.html' },
            'gen-microbiology': { title: 'Microbiology Reports', url: 'reportgeneration-microbiology.html' },
            'gen-urine': { title: 'Urine Analysis Reports', url: 'reportgeneration-urine.html' },
            'gen-stool': { title: 'Stool Analysis Reports', url: 'reportgeneration-stool.html' },
            'gen-afb': { title: 'AFB Smear Reports', url: 'reportgeneration-afb.html' },
            'gen-gramstain': { title: 'Gram Stain Reports', url: 'reportgeneration-gramstain.html' },
            'gen-fluidcytology': { title: 'Fluid Cytology Reports', url: 'reportgeneration-fluidcytology.html' },
            'gen-custom': { title: 'Custom Report Templates', url: 'reportgeneration-custom.html' }
        }
    },
    documentation: {
        title: 'Documentation',
        subpages: {
            'doc-qcsummary': { title: 'QC Summary Documents', url: 'documentation-qcsummary.html' },
            'doc-consumption': { title: 'Consumption Reports/Docs', url: 'documentation-consumption.html' },
            'doc-sops': { title: 'Standard Operating Procedures', url: 'documentation-sops.html' },
            'doc-training': { title: 'Training Materials', url: 'documentation-training.html' }
        }
    },
    generalreports: {
        title: 'General Reports',
        subpages: {
            'report-overview': { title: 'Reports Overview', url: 'generalreports-overview.html' },
            'report-custom': { title: 'Create Custom Reports', url: 'generalreports-custom.html' }
        }
    },
    tools: {
        title: 'Tools',
        subpages: {
            'tools-calendar': { title: 'Calendar', url: 'tools-calendar.html' },
            'tools-calculator': { title: 'Calculator', url: 'tools-calculator.html' },
            'tools-clock': { title: 'Clock', url: 'tools-clock.html' },
            'tools-timer': { title: 'Timer & Stopwatch', url: 'tools-timer.html' },
            'tools-notepad': { title: 'Notepad', url: 'tools-notepad.html' },
            'tools-unitconverter': { title: 'Unit Converter', url: 'tools-unitconverter.html' },
            'tools-referenceranges': { title: 'Reference Ranges', url: 'tools-referenceranges.html' }
        }
    },
    settings: {
        title: 'Settings',
        subpages: {
            'settings-account': { title: 'Account Settings', url: 'settings-account.html' },
            'settings-team': { title: 'Team Management', url: 'settings-team.html' },
            'settings-notifications': { title: 'Notification Preferences', url: 'settings-notifications.html' },
            'settings-lab': { title: 'Lab Configuration', url: 'settings-labsetup.html' }
        }
    }
};

class NavManager {
    constructor() {
        this.currentPage = localStorage.getItem('currentPage') || 'dashboard';
        this.currentSubPage = localStorage.getItem('currentSubPage') || null;
        this.openSubmenuId = localStorage.getItem('openSubmenuId') || null;
        this.initEventListeners();
        this.loadInitialPage();
        this.handleResponsive();
    }

    initEventListeners() {
        menuToggleBtn.addEventListener('click', () => this.toggleSidebar());
        overlay.addEventListener('click', () => this.closeSidebar());

        userMenuBtn.addEventListener('click', () => {
            const isHidden = userDropdown.classList.toggle('hidden');
            userMenuBtn.setAttribute('aria-expanded', !isHidden);
        });
        document.addEventListener('click', (e) => {
            if (!userMenuBtn.contains(e.target) && !userDropdown.contains(e.target)) {
                userDropdown.classList.add('hidden');
                userMenuBtn.setAttribute('aria-expanded', 'false');
            }
        });

        const handleNavClick = this.debounce((e) => {
            const mainPageLink = e.target.closest('.sidebar-main-item[data-page], a[data-page]:not(.sidebar-main-item):not(.sidebar-submenu-item)');
            const subPageLink = e.target.closest('.sidebar-submenu-item[data-subpage]');
            const statCard = e.target.closest('.stat-card[data-page][data-subpage]');

            if (mainPageLink && mainPageLink.dataset.page) {
                e.preventDefault();
                const pageId = mainPageLink.dataset.page;
                console.log(`Main menu clicked: ${pageId}`);
                this.handleMainMenuClick(pageId);
            } else if (subPageLink && subPageLink.dataset.subpage) {
                e.preventDefault();
                const subPageId = subPageLink.dataset.subpage;
                const parentPageId = subPageLink.closest('.submenu-container').id.replace('-submenu', '');
                console.log(`Submenu clicked: ${parentPageId} -> ${subPageId}`);
                this.changeSubPage(parentPageId, subPageId, subPageLink);
                if (window.innerWidth < 768 && !sidebar.classList.contains('-translate-x-full')) {
                    this.closeSidebar();
                }
            } else if (statCard && statCard.dataset.page && statCard.dataset.subpage) {
                e.preventDefault();
                const pageId = statCard.dataset.page;
                const subPageId = statCard.dataset.subpage;
                console.log(`Stat card clicked: ${pageId} -> ${subPageId}`);
                this.changePage(pageId);
                const subItem = document.querySelector(`#${pageId}-submenu .sidebar-submenu-item[data-subpage="${subPageId}"]`);
                if (subItem) {
                    const submenu = document.getElementById(`${pageId}-submenu`);
                    if (submenu && !submenu.classList.contains('active')) {
                        this.toggleSubmenu(submenu);
                    }
                    this.changeSubPage(pageId, subPageId, subItem);
                }
            }
        }, 200);

        document.addEventListener('click', handleNavClick);

        sidebarNav.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                const item = e.target.closest('.sidebar-item');
                if (item) item.click();
            }
        });

        window.addEventListener('resize', this.debounce(() => this.handleResponsive(), 150));
    }

    handleMainMenuClick(pageId) {
        if (!pages[pageId]) {
            console.warn(`Page definition not found for: ${pageId}`);
            return;
        }

        this.currentPage = pageId;
        localStorage.setItem('currentPage', pageId);

        const submenu = document.getElementById(`${pageId}-submenu`);
        if (submenu) {
            this.toggleSubmenu(submenu);

            if (!submenu.classList.contains('active')) {
                if (this.currentSubPage && pages[pageId].subpages[this.currentSubPage]) {
                    const subItem = submenu.querySelector(`.sidebar-submenu-item[data-subpage="${this.currentSubPage}"]`);
                    if (subItem) {
                        this.changeSubPage(pageId, this.currentSubPage, subItem);
                    }
                } else {
                    const firstSubItem = submenu.querySelector('.sidebar-submenu-item');
                    if (firstSubItem) {
                        const subPageId = firstSubItem.dataset.subpage;
                        this.changeSubPage(pageId, subPageId, firstSubItem);
                    }
                }
            } else {
                this.currentSubPage = null;
                localStorage.removeItem('currentSubPage');
                breadcrumbSubpageContainer.classList.add('hidden');
            }
        } else {
            this.currentSubPage = null;
            localStorage.removeItem('currentSubPage');
            breadcrumbSubpageContainer.classList.add('hidden');
        }

        this.updateNavigation(pageId);
        breadcrumbCurrent.textContent = pages[pageId].title;
    }

    toggleSubmenu(submenu) {
        const submenuId = submenu.id;
        console.log(`Toggling submenu: ${submenuId}, currently active: ${submenu.classList.contains('active')}`);
        const openingDuration = 300;
        const closingDuration = 100;

        if (submenu.classList.contains('active')) {
            submenu.style.height = `${submenu.scrollHeight}px`;
            submenu.offsetHeight;
            submenu.style.height = '0';
            submenu.style.transform = 'scaleY(0)';
            submenu.style.paddingTop = '0';
            submenu.style.paddingBottom = '0';
            submenu.classList.remove('active');
            setTimeout(() => {
                if (!submenu.classList.contains('active')) {
                    submenu.style.height = '';
                    submenu.style.transform = '';
                    submenu.style.padding = '';
                }
            }, closingDuration);
            if (localStorage.getItem('openSubmenuId') === submenuId) {
                localStorage.removeItem('openSubmenuId');
            }
            this.openSubmenuId = null;
        } else {
            const activeSubmenu = document.querySelector('.submenu-container.active');
            const openTargetSubmenu = () => {
                submenu.classList.add('active');
                submenu.style.height = '0';
                submenu.style.transform = 'scaleY(0)';
                submenu.style.paddingTop = '0';
                submenu.style.paddingBottom = '0';
                submenu.offsetHeight;
                submenu.style.height = `${submenu.scrollHeight}px`;
                submenu.style.transform = 'scaleY(1)';
                submenu.style.padding = '1.5rem 0';
                setTimeout(() => {
                    if (submenu.classList.contains('active')) {
                        submenu.style.height = 'auto';
                    }
                }, openingDuration);
                localStorage.setItem('openSubmenuId', submenuId);
                this.openSubmenuId = submenuId;
            };

            if (activeSubmenu && activeSubmenu !== submenu) {
                activeSubmenu.style.height = `${activeSubmenu.scrollHeight}px`;
                activeSubmenu.offsetHeight;
                activeSubmenu.style.height = '0';
                activeSubmenu.style.transform = 'scaleY(0)';
                activeSubmenu.style.paddingTop = '0';
                activeSubmenu.style.paddingBottom = '0';
                activeSubmenu.classList.remove('active');
                if (localStorage.getItem('openSubmenuId') === activeSubmenu.id) {
                    localStorage.removeItem('openSubmenuId');
                }
                setTimeout(() => {
                    if (!activeSubmenu.classList.contains('active')) {
                        activeSubmenu.style.height = '';
                        activeSubmenu.style.transform = '';
                        activeSubmenu.style.padding = '';
                    }
                    openTargetSubmenu();
                }, closingDuration);
            } else {
                openTargetSubmenu();
            }
        }
    }

    toggleSidebar() {
        sidebar.classList.toggle('-translate-x-full');
        overlay.classList.toggle('active');
    }

    closeSidebar() {
        sidebar.classList.add('-translate-x-full');
        overlay.classList.remove('active');
    }

    loadInitialPage() {
        this.currentPage = localStorage.getItem('currentPage') || 'dashboard';
        this.currentSubPage = localStorage.getItem('currentSubPage') || null;
        this.openSubmenuId = localStorage.getItem('openSubmenuId') || null;
        this.changePage(this.currentPage, true);
    }

    changePage(pageId, isInitialLoad = false) {
        if (!pages[pageId]) {
            console.warn(`Page definition not found for: ${pageId}`);
            return;
        }

        this.currentPage = pageId;
        localStorage.setItem('currentPage', pageId);

        const pageContent = document.getElementById(`${pageId}-content`);
        const iframe = document.getElementById(`${pageId}-iframe`);
        const loadingElement = document.getElementById(`${pageId}-loading`);

        pageContents.forEach(page => {
            if (page.id !== `${pageId}-content`) {
                page.classList.remove('active');
                const iframe = page.querySelector('iframe');
                if (iframe && iframe.src) {
                    iframe.src = 'about:blank';
                    iframe.dataset.src = '';
                }
            }
        });
        if (pageContent) {
            setTimeout(() => pageContent.classList.add('active'), 50);
        } else {
            console.warn(`Page content container not found: #${pageId}-content`);
        }

        this.updateNavigation(pageId);
        breadcrumbCurrent.textContent = pages[pageId].title;

        this.updateSubmenuVisibility(pageId, isInitialLoad);

        if (this.currentSubPage && pages[pageId].subpages && pages[pageId].subpages[this.currentSubPage]) {
            const subItem = document.querySelector(`#${pageId}-submenu .sidebar-submenu-item[data-subpage="${this.currentSubPage}"]`);
            if (subItem) {
                this.changeSubPage(pageId, this.currentSubPage, subItem, true);
            }
        } else if (isInitialLoad && pages[pageId].subpages) {
            const submenu = document.getElementById(`${pageId}-submenu`);
            if (submenu) {
                const firstSubItem = submenu.querySelector('.sidebar-submenu-item');
                if (firstSubItem) {
                    const subPageId = firstSubItem.dataset.subpage;
                    this.changeSubPage(pageId, subPageId, firstSubItem, true);
                }
            }
        }
    }

    changeSubPage(parentPageId, subPageId, clickedElement, fromChangePage = false) {
        if (!pages[parentPageId] || !pages[parentPageId].subpages[subPageId]) {
            console.warn(`Subpage definition not found for: ${parentPageId} -> ${subPageId}`);
            if (fromChangePage) {
                this.currentSubPage = null;
                localStorage.removeItem('currentSubPage');
                breadcrumbSubpageContainer.classList.add('hidden');
            }
            return;
        }

        this.currentSubPage = subPageId;
        localStorage.setItem('currentSubPage', subPageId);

        const currentSubmenu = document.getElementById(`${parentPageId}-submenu`);
        if (currentSubmenu) {
            currentSubmenu.querySelectorAll('.sidebar-submenu-item').forEach(item => {
                item.classList.remove('active');
            });
            if (clickedElement) {
                clickedElement.classList.add('active');
                breadcrumbSubpage.textContent = clickedElement.querySelector('span').textContent;
                breadcrumbSubpageContainer.classList.remove('hidden');
            } else {
                const activeSubItem = currentSubmenu.querySelector(`.sidebar-submenu-item[data-subpage="${subPageId}"]`);
                if (activeSubItem) {
                    activeSubItem.classList.add('active');
                    breadcrumbSubpage.textContent = activeSubItem.querySelector('span').textContent;
                    breadcrumbSubpageContainer.classList.remove('hidden');
                } else {
                    breadcrumbSubpageContainer.classList.add('hidden');
                }
            }
        } else {
            breadcrumbSubpageContainer.classList.add('hidden');
        }

        const iframe = document.getElementById(`${parentPageId}-iframe`);
        const loadingElement = document.getElementById(`${parentPageId}-loading`);
        const newSrc = pages[parentPageId].subpages[subPageId].url;

        if (iframe && newSrc) {
            const currentSrcBase = iframe.src.split('#')[0];
            const newSrcBase = newSrc.split('#')[0];

            if (currentSrcBase !== newSrcBase || iframe.dataset.src !== newSrc) {
                console.log(`Loading iframe: ${newSrc}`);
                if (loadingElement) loadingElement.classList.remove('hidden');
                iframe.src = newSrc;
                iframe.dataset.src = newSrc;

                const tempOnload = () => {
                    if (loadingElement) loadingElement.classList.add('hidden');
                    iframe.style.height = '100%';
                    iframe.style.width = '100%';
                    iframe.removeEventListener('load', tempOnload);
                };
                iframe.addEventListener('load', tempOnload);

                iframe.onerror = () => {
                    if (loadingElement) loadingElement.classList.add('hidden');
                    console.error(`Failed to load iframe content for ${newSrc}`);
                };
            } else {
                if (loadingElement) loadingElement.classList.add('hidden');
                iframe.style.height = '100%';
                iframe.style.width = '100%';
            }
        } else {
            if (loadingElement) loadingElement.classList.add('hidden');
        }
    }

    updateNavigation(pageId) {
        sidebarNav.querySelectorAll('.sidebar-main-item').forEach(item => {
            item.classList.toggle('active', item.dataset.page === pageId);
        });

        bottomNav.querySelectorAll('.bottom-nav-item').forEach(item => {
            if (item.dataset.page) {
                item.classList.toggle('active', item.dataset.page === pageId);
                item.setAttribute('aria-current', item.dataset.page === pageId ? 'page' : 'false');
            }
        });
    }

    updateSubmenuVisibility(pageId, isInitialLoad = false) {
        const targetSubmenu = document.getElementById(`${pageId}-submenu`);
        const savedOpenSubmenuId = isInitialLoad ? this.openSubmenuId : null;

        submenuContainers.forEach(container => {
            if (container.id !== `${pageId}-submenu` && container.classList.contains('active')) {
                this.toggleSubmenu(container);
            }
        });

        if (targetSubmenu) {
            if ((isInitialLoad && savedOpenSubmenuId && targetSubmenu.id === savedOpenSubmenuId) ||
                (!isInitialLoad && !targetSubmenu.classList.contains('active'))) {
                if (!targetSubmenu.classList.contains('active')) {
                    this.toggleSubmenu(targetSubmenu);
                }
            }

            let subItemToActivate = null;
            let subPageIdForLoading = this.currentSubPage;

            if (this.currentSubPage && pages[pageId].subpages && pages[pageId].subpages[this.currentSubPage]) {
                subItemToActivate = targetSubmenu.querySelector(`.sidebar-submenu-item[data-subpage="${this.currentSubPage}"]`);
            }

            if (!subItemToActivate && pages[pageId].subpages) {
                if (!isInitialLoad || (isInitialLoad && localStorage.getItem('currentSubPage') === null)) {
                    const firstSubItem = targetSubmenu.querySelector('.sidebar-submenu-item');
                    if (firstSubItem) {
                        subItemToActivate = firstSubItem;
                        subPageIdForLoading = firstSubItem.dataset.subpage;
                        this.currentSubPage = subPageIdForLoading;
                        localStorage.setItem('currentSubPage', subPageIdForLoading);
                    } else {
                        subPageIdForLoading = null;
                        this.currentSubPage = null;
                        localStorage.removeItem('currentSubPage');
                    }
                } else if (isInitialLoad && this.currentSubPage && (!pages[pageId].subpages || !pages[pageId].subpages[this.currentSubPage])) {
                    const firstSubItem = targetSubmenu.querySelector('.sidebar-submenu-item');
                    if (firstSubItem) {
                        subItemToActivate = firstSubItem;
                        subPageIdForLoading = firstSubItem.dataset.subpage;
                        this.currentSubPage = subPageIdForLoading;
                        localStorage.setItem('currentSubPage', subPageIdForLoading);
                    }
                }
            }

            targetSubmenu.querySelectorAll('.sidebar-submenu-item.active').forEach(activeItem => {
                if (activeItem !== subItemToActivate) {
                    activeItem.classList.remove('active');
                }
            });

            if (subItemToActivate) {
                if (!subItemToActivate.classList.contains('active')) {
                    subItemToActivate.classList.add('active');
                }
                breadcrumbSubpage.textContent = subItemToActivate.querySelector('span').textContent;
                breadcrumbSubpageContainer.classList.remove('hidden');

                if (subPageIdForLoading) {
                    this.changeSubPage(pageId, subPageIdForLoading, subItemToActivate, true);
                }
            } else {
                breadcrumbSubpageContainer.classList.add('hidden');
            }
        } else {
            breadcrumbSubpageContainer.classList.add('hidden');
            this.currentSubPage = null;
            if (!isInitialLoad) {
                localStorage.removeItem('currentSubPage');
            }
            const anyActiveSubmenu = document.querySelector('.submenu-container.active');
            if (anyActiveSubmenu) {
                this.toggleSubmenu(anyActiveSubmenu);
            }
            if (this.openSubmenuId) {
                localStorage.removeItem('openSubmenuId');
                this.openSubmenuId = null;
            }
        }
    }

    handleResponsive() {
        if (window.innerWidth >= 768) {
            sidebar.classList.remove('-translate-x-full');
            overlay.classList.remove('active');
        } else {
            if (!overlay.classList.contains('active')) {
                sidebar.classList.add('-translate-x-full');
            }
        }
    }

    debounce(fn, wait) {
        let timeout;
        return (...args) => {
            clearTimeout(timeout);
            timeout = setTimeout(() => fn.apply(this, args), wait);
        };
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const navManager = new NavManager();
});
</script>
    <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'93a8dc5b5cf5bfe7',t:'MTc0NjM3MDc1My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>